<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Custom element</title>
    </head>
    <body>

        <data-repeater>
            <div>
                <h2>${language}</h2>
                <p>${type}</p>
            </div>
        </data-repeater>

        <script type="module" src="src/data-repeater.js"></script>

        <script>
            var init = function() {
                var repeater = document.querySelector('data-repeater');

                repeater.data = [
                    {language: 'javascript', type: 'both'},
                    {language: 'scala', type: 'backend'},
                    {language: 'haskell', type: 'backend'},
                    {language: 'typescript', type: 'frontend'}
                ];

                setTimeout(function() {
                    repeater.data = [
                        {language: 'scala', type: 'backend'},
                        {language: 'javascript', type: 'both'},
                        {language: 'haskell', type: 'backend'},
                        {language: 'typescript', type: 'frontend'},
                        {language: 'PHP', type: 'backend'}
                    ];
                }, 2000);

                setTimeout(function() {
                    repeater.data = [
                        {language: 'javascript', type: 'both'}
                    ];
                }, 4000);
            };



            if(!('customElements' in window)) {
                console.log('loading polyfill');

                var loadjs = function(file, cb) {
                    var script = document.createElement("script");
                    script.src = file;
                    script.onload = cb;
                    document.querySelector('head').appendChild(script);
                };

                var bundle = 'Proxy' in window ? 'dist/app.bundle.js' : 'dist/app.js';

                loadjs('lib/webcomponents-lite.js', function() {
                    if(window.WebComponents) {
                        window.addEventListener('WebComponentsReady', function() {
                            console.log('WebComponentsReady, loading', bundle);
                            loadjs(bundle, init);
                        });
                    }
                });
            }
            else {
                console.log('no polyfill');

                customElements.whenDefined('data-repeater')
                .then(function() {
                    console.log('data-repeater ready');
                    init();
                });
            }
        </script>

    </body>
</html>